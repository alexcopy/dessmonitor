apiVersion: apps/v1
kind: Deployment
metadata:
  name: dessmonitor
spec:
  replicas: 1
  selector:
    matchLabels: { app: dessmonitor }
  template:
    metadata:
      labels: { app: dessmonitor }
    spec:
      containers:
      - name: dessmonitor
        image: redcopy/dessmonitor:latest        # üëà¬†—Ç–æ—Ç –∂–µ –æ–±—Ä–∞–∑, —á—Ç–æ –∏ –≤ compose
        # ---------- volumeMounts = ¬´–∫—É–¥–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ¬ª ----------
        volumeMounts:
        - name: logs
          mountPath: /app/logs
        - name: cache
          mountPath: /app/app/cache
        - name: cfg
          mountPath: /app/config.json
          subPath: config.json
          readOnly: true
        - name: cfg
          mountPath: /app/devices.yaml
          subPath: devices.yaml
          readOnly: true
        ports:
        - containerPort: 8000      # –∫–∞–∫ –≤ compose

      # ---------- volumes = ¬´–æ—Ç–∫—É–¥–∞ –Ω–∞ –Ω–æ–¥–µ (–∏–ª–∏ –∏–∑ PVC)¬ª ----------
      volumes:
      - name: logs
        hostPath:
          path: /srv/dessmonitor/logs
          type: DirectoryOrCreate
      - name: cache
        hostPath:
          path: /srv/dessmonitor/cache
          type: DirectoryOrCreate

      # –û–±–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞ –∏–∑ –æ–¥–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ hostPath
      - name: cfg
        hostPath:
          path: /srv/dessmonitor/configs         # —Å–æ–¥–µ—Ä–∂–∏—Ç 2¬†—Ñ–∞–π–ª–∞
          type: Directory
